{"filter":false,"title":"config.yml","tooltip":"/.circleci/config.yml","undoManager":{"mark":6,"position":6,"stack":[[{"start":{"row":0,"column":0},"end":{"row":156,"column":0},"action":"insert","lines":["version: 2.1","","orbs:","  aws-cli: circleci/aws-cli@3.1.5","","jobs:","","","  install_stage:","    docker:","      - image: cimg/python:3.11","    steps:","      - checkout","","      - run:","          name: Install Python Dependencies","          command: |","            python -m pip install --upgrade pip","            pip install -r requirements.txt","","      - run:","          name: Install OS dependencies","          command: |","            sudo apt-get update","            sudo apt-get install -y jq unzip wget","","      - run:","          name: Install Java 17 (Amazon Corretto)","          command: |","            sudo apt-get purge -y openjdk*","            sudo apt-get install -y java-common","            wget https://corretto.aws/downloads/latest/amazon-corretto-17-x64-linux-jdk.deb","            sudo dpkg -i amazon-corretto-17-x64-linux-jdk.deb","            java --version","","","  pylint_stage:","    docker:","      - image: cimg/python:3.11","    steps:","      - checkout","","      - run:","          name: Install Python Tools","          command: |","            pip install --upgrade pip","            pip install -r requirements.txt","            pip install pylint","","      - run:","          name: Run pylint","          command: |","            pylint easy_bill || true","","  sonar_stage:","    docker:","      - image: cimg/python:3.11","    steps:","      - checkout","","      - run:","          name: Install Sonar Scanner","          command: |","            wget https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-5.0.1.3006-linux.zip","            unzip sonar-scanner-cli-5.0.1.3006-linux.zip","            mv sonar-scanner-5.0.1.3006-linux sonar-scanner","","      - run:","          name: Run Sonar Scan","          command: |","            sonar-scanner/bin/sonar-scanner \\","              -Dsonar.login=$SONAR_TOKEN \\","              -Dsonar.host.url=https://sonarcloud.io \\","              -Dsonar.projectKey=$SONAR_PROJECT_KEY \\","              -Dsonar.organization=$SONAR_ORG \\","              -Dsonar.exclusions=**/.c9/**,**/node_modules/**,**/venv/** \\","              -Dsonar.text.exclusions=**/.c9/** \\","              -Dsonar.scm.disabled=true \\","              -Dsonar.scm.exclusions.enabled=true \\","              || true","","","","  django_test_stage:","    docker:","      - image: cimg/python:3.11","    steps:","      - checkout","","      - run:","          name: Install Python Dependencies","          command: |","            pip install --upgrade pip","            pip install -r requirements.txt","","      - run:","          name: Django Tests","          command: |","            python manage.py test","","","  build_and_deploy:","    docker:","      - image: cimg/python:3.11","","    environment:","      AWS_REGION: us-east-1","","    steps:","      - checkout","","      - run:","          name: Create Deployment ZIP","          command: |","            zip -r deploy.zip . -x \"*.git*\"","","      - aws-cli/setup:","          aws-access-key-id: AWS_ACCESS_KEY_ID","          aws-secret-access-key: AWS_SECRET_ACCESS_KEY","          aws-region: AWS_REGION","","      - run:","          name: Load AWS Session Token","          command: |","            echo \"export AWS_SESSION_TOKEN=$AWS_SESSION_TOKEN\" >> $BASH_ENV","            source $BASH_ENV","","      - run:","          name: Deploy to Elastic Beanstalk","          command: |","            pip install awsebcli","            eb init \"devops-eb-myapp\" --platform python-3.11 --region \"$AWS_REGION\"","            eb deploy myapp-x23304723","","","# ==========================================================","# WORKFLOW","# ==========================================================","workflows:","  version: 2","  full_ci_pipeline:","    jobs:","      - install_stage","      - pylint_stage:","          requires:","            - install_stage","      - sonar_stage:","          requires:","            - install_stage","      - django_test_stage:","          requires:","            - pylint_stage","      - build_and_deploy:","          requires:","            - django_test_stage","            - sonar_stage",""],"id":1}],[{"start":{"row":0,"column":0},"end":{"row":156,"column":0},"action":"remove","lines":["version: 2.1","","orbs:","  aws-cli: circleci/aws-cli@3.1.5","","jobs:","","","  install_stage:","    docker:","      - image: cimg/python:3.11","    steps:","      - checkout","","      - run:","          name: Install Python Dependencies","          command: |","            python -m pip install --upgrade pip","            pip install -r requirements.txt","","      - run:","          name: Install OS dependencies","          command: |","            sudo apt-get update","            sudo apt-get install -y jq unzip wget","","      - run:","          name: Install Java 17 (Amazon Corretto)","          command: |","            sudo apt-get purge -y openjdk*","            sudo apt-get install -y java-common","            wget https://corretto.aws/downloads/latest/amazon-corretto-17-x64-linux-jdk.deb","            sudo dpkg -i amazon-corretto-17-x64-linux-jdk.deb","            java --version","","","  pylint_stage:","    docker:","      - image: cimg/python:3.11","    steps:","      - checkout","","      - run:","          name: Install Python Tools","          command: |","            pip install --upgrade pip","            pip install -r requirements.txt","            pip install pylint","","      - run:","          name: Run pylint","          command: |","            pylint easy_bill || true","","  sonar_stage:","    docker:","      - image: cimg/python:3.11","    steps:","      - checkout","","      - run:","          name: Install Sonar Scanner","          command: |","            wget https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-5.0.1.3006-linux.zip","            unzip sonar-scanner-cli-5.0.1.3006-linux.zip","            mv sonar-scanner-5.0.1.3006-linux sonar-scanner","","      - run:","          name: Run Sonar Scan","          command: |","            sonar-scanner/bin/sonar-scanner \\","              -Dsonar.login=$SONAR_TOKEN \\","              -Dsonar.host.url=https://sonarcloud.io \\","              -Dsonar.projectKey=$SONAR_PROJECT_KEY \\","              -Dsonar.organization=$SONAR_ORG \\","              -Dsonar.exclusions=**/.c9/**,**/node_modules/**,**/venv/** \\","              -Dsonar.text.exclusions=**/.c9/** \\","              -Dsonar.scm.disabled=true \\","              -Dsonar.scm.exclusions.enabled=true \\","              || true","","","","  django_test_stage:","    docker:","      - image: cimg/python:3.11","    steps:","      - checkout","","      - run:","          name: Install Python Dependencies","          command: |","            pip install --upgrade pip","            pip install -r requirements.txt","","      - run:","          name: Django Tests","          command: |","            python manage.py test","","","  build_and_deploy:","    docker:","      - image: cimg/python:3.11","","    environment:","      AWS_REGION: us-east-1","","    steps:","      - checkout","","      - run:","          name: Create Deployment ZIP","          command: |","            zip -r deploy.zip . -x \"*.git*\"","","      - aws-cli/setup:","          aws-access-key-id: AWS_ACCESS_KEY_ID","          aws-secret-access-key: AWS_SECRET_ACCESS_KEY","          aws-region: AWS_REGION","","      - run:","          name: Load AWS Session Token","          command: |","            echo \"export AWS_SESSION_TOKEN=$AWS_SESSION_TOKEN\" >> $BASH_ENV","            source $BASH_ENV","","      - run:","          name: Deploy to Elastic Beanstalk","          command: |","            pip install awsebcli","            eb init \"devops-eb-myapp\" --platform python-3.11 --region \"$AWS_REGION\"","            eb deploy myapp-x23304723","","","# ==========================================================","# WORKFLOW","# ==========================================================","workflows:","  version: 2","  full_ci_pipeline:","    jobs:","      - install_stage","      - pylint_stage:","          requires:","            - install_stage","      - sonar_stage:","          requires:","            - install_stage","      - django_test_stage:","          requires:","            - pylint_stage","      - build_and_deploy:","          requires:","            - django_test_stage","            - sonar_stage",""],"id":2}],[{"start":{"row":0,"column":0},"end":{"row":146,"column":0},"action":"insert","lines":["version: 2.1","","orbs:","  aws-cli: circleci/aws-cli@3.1.5","","jobs:","","  # ======================================================","  # 1. INSTALLATIONS","  # ======================================================","  installations:","    docker:","      - image: cimg/python:3.11","    steps:","      - checkout","","      - run:","          name: Install Python Dependencies","          command: |","            python -m pip install --upgrade pip","            pip install -r requirements.txt","            pip install pylint","","      - run:","          name: Install OS Dependencies","          command: |","            sudo apt-get update","            sudo apt-get install -y jq unzip wget","","      - run:","          name: Install Java 17 (Corretto)","          command: |","            sudo apt-get purge -y openjdk*","            sudo apt-get install -y java-common","            wget https://corretto.aws/downloads/latest/amazon-corretto-17-x64-linux-jdk.deb","            sudo dpkg -i amazon-corretto-17-x64-linux-jdk.deb","            java --version","","      - run:","          name: Install Sonar Scanner","          command: |","            wget https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-5.0.1.3006-linux.zip","            unzip sonar-scanner-cli-5.0.1.3006-linux.zip","            mv sonar-scanner-5.0.1.3006-linux sonar-scanner","","","  # ======================================================","  # 2. TESTS (pylint + django tests + sonar scan)","  # ======================================================","  tests:","    docker:","      - image: cimg/python:3.11","","    steps:","      - checkout","","      - run:","          name: Install Python Dependencies","          command: |","            pip install -r requirements.txt","            pip install pylint","","      - run:","          name: Run pylint","          command: |","            pylint easy_bill || true","","      - run:","          name: Run Django Tests","          command: |","            python manage.py test || true","","      - run:","          name: Run Sonar Scan","          command: |","            sonar-scanner/bin/sonar-scanner \\","              -Dsonar.login=$SONAR_TOKEN \\","              -Dsonar.host.url=https://sonarcloud.io \\","              -Dsonar.projectKey=$SONAR_PROJECT_KEY \\","              -Dsonar.organization=$SONAR_ORG \\","              -Dsonar.exclusions=**/.c9/**,**/node_modules/**,**/venv/** \\","              -Dsonar.text.exclusions=**/.c9/** \\","              -Dsonar.scm.disabled=true \\","              -Dsonar.scm.exclusions.enabled=true \\","              || true","","","  # ======================================================","  # 3. BUILD","  # ======================================================","  build:","    docker:","      - image: cimg/python:3.11","","    steps:","      - checkout","","      - run:","          name: Create Deployment ZIP","          command: |","            zip -r deploy.zip . -x \"*.git*\"","","","  # ======================================================","  # 4. DEPLOY","  # ======================================================","  deploy:","    docker:","      - image: cimg/python:3.11","    environment:","      AWS_REGION: us-east-1","","    steps:","      - checkout","","      - aws-cli/setup:","          aws-access-key-id: AWS_ACCESS_KEY_ID","          aws-secret-access-key: AWS_SECRET_ACCESS_KEY","          aws-region: AWS_REGION","","      - run:","          name: Deploy to Elastic Beanstalk","          command: |","            pip install awsebcli","            eb init \"devops-eb-myapp\" --platform python-3.11 --region \"$AWS_REGION\"","            eb deploy myapp-x23304723","","","","# ======================================================","# WORKFLOW (RUNS 4 STAGES)","# ======================================================","workflows:","  version: 2","  pipeline:","    jobs:","      - installations","      - tests:","          requires:","            - installations","      - build:","          requires:","            - tests","      - deploy:","          requires:","            - build",""],"id":3}],[{"start":{"row":7,"column":0},"end":{"row":9,"column":58},"action":"remove","lines":["  # ======================================================","  # 1. INSTALLATIONS","  # ======================================================"],"id":4}],[{"start":{"row":43,"column":0},"end":{"row":46,"column":58},"action":"remove","lines":["","  # ======================================================","  # 2. TESTS (pylint + django tests + sonar scan)","  # ======================================================"],"id":5}],[{"start":{"row":82,"column":0},"end":{"row":84,"column":58},"action":"remove","lines":["  # ======================================================","  # 3. BUILD","  # ======================================================"],"id":6}],[{"start":{"row":96,"column":0},"end":{"row":98,"column":58},"action":"remove","lines":["  # ======================================================","  # 4. DEPLOY","  # ======================================================"],"id":7}]]},"ace":{"folds":[],"scrolltop":979.2000000000003,"scrollleft":0,"selection":{"start":{"row":97,"column":9},"end":{"row":97,"column":9},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":74,"state":["mlString",11],"mode":"ace/mode/yaml"}},"timestamp":1764666659003,"hash":"b1cc513213ef8e54800faa0391c4f4e69b05e7cb"}